diff -ur -x .svn /data/deadwood/source/Mesa-7.7/src/mesa/glapi/glapi.c mesa/glapi/glapi.c
--- /data/deadwood/source/Mesa-7.7/src/mesa/glapi/glapi.c	2009-11-17 17:54:28.000000000 +0100
+++ mesa/glapi/glapi.c	2009-12-22 18:11:36.000000000 +0100
@@ -223,9 +223,12 @@
 
 #endif /* defined(THREADS) */
 
+#if defined(__AROS__) && defined(AROS_MESA_SHARED)
+#else
 PUBLIC struct _glapi_table *_glapi_Dispatch = 
   (struct _glapi_table *) __glapi_noop_table;
 PUBLIC void *_glapi_Context = NULL;
+#endif
 
 #endif /* defined(GLX_USE_TLS) */
 /*@}*/
diff -ur -x .svn /data/deadwood/source/Mesa-7.7/src/mesa/glapi/glapi.h mesa/glapi/glapi.h
--- /data/deadwood/source/Mesa-7.7/src/mesa/glapi/glapi.h	2009-11-17 17:54:28.000000000 +0100
+++ mesa/glapi/glapi.h	2009-12-22 18:11:36.000000000 +0100
@@ -53,6 +53,38 @@
 
 struct _glapi_table;
 
+#if defined(__AROS__) 
+#if defined(AROS_MESA_SHARED)
+
+#if defined(__i386__)
+register struct MesaBase * REGMesaBase __asm__("ebx");
+#elif defined(__x86_64__)
+register struct MesaBase * REGMesaBase __asm__("rbx");
+#elif defined(PPC) || defined (__powerpc__)
+/*
+ * r11 or r12 emit call clobbered register warnings
+ * r13 works as well, but is small data area pointer
+ * in SysV ABI, which we might use in the future
+ */
+register struct MesaBase * REGMesaBase __asm__("r14");
+#else
+#error Select register for your architecture
+#endif
+
+#define SAVE_REG            struct MesaBase * reg = REGMesaBase;
+#define PUT_MESABASE_IN_REG REGMesaBase = (struct MesaBase *)MesaBase;
+#define RESTORE_REG         REGMesaBase = reg;
+extern void                     **GETMESABASECTX(void);
+extern struct _glapi_table      **GETMESABASEDDISPATCH(void);
+#else
+
+#define SAVE_REG
+#define PUT_MESABASE_IN_REG
+#define RESTORE_REG
+
+#endif
+#endif
+
 typedef void (*_glapi_proc)(void); /* generic function pointer */
 
 typedef void (*_glapi_warning_func)(void *ctx, const char *str, ...);
@@ -89,9 +121,19 @@
 # define GET_CURRENT_CONTEXT(C)  GLcontext *C = (GLcontext *) _glapi_tls_Context
 
 #else
-
+ 
+#if defined(__AROS__) && defined(AROS_MESA_SHARED)
+# if defined(USE_MGL_NAMESPACE)
+#  define _mglapi_Context *(GETMESABASECTX())
+#  define _mglapi_Dispatch *(GETMESABASEDDISPATCH())
+# else
+#  define _glapi_Context *(GETMESABASECTX())
+#  define _glapi_Dispatch *(GETMESABASEDDISPATCH())
+# endif
+#else
 extern void *_glapi_Context;
 extern struct _glapi_table *_glapi_Dispatch;
+#endif
 
 # ifdef THREADS
 #  define GET_CURRENT_CONTEXT(C)  GLcontext *C = (GLcontext *) (_glapi_Context ? _glapi_Context : _glapi_get_context())
diff -ur -x .svn /data/deadwood/source/Mesa-7.7/src/mesa/main/compiler.h mesa/main/compiler.h
--- /data/deadwood/source/Mesa-7.7/src/mesa/main/compiler.h	2009-12-21 18:23:40.000000000 +0100
+++ mesa/main/compiler.h	2009-12-22 18:14:42.000000000 +0100
@@ -234,6 +234,8 @@
 #elif defined(__APPLE__)
 #include <CoreFoundation/CFByteOrder.h>
 #define CPU_TO_LE32( x )	CFSwapInt32HostToLittle( x )
+#elif defined(__AROS__)
+#define CPU_TO_LE32( x )    AROS_BE2LONG( x )
 #elif (defined(_AIX) || defined(__blrts))
 #define CPU_TO_LE32( x )        x = ((x & 0x000000ff) << 24) | \
                                     ((x & 0x0000ff00) <<  8) | \
diff -ur -x .svn /data/deadwood/source/Mesa-7.7/src/mesa/main/imports.c mesa/main/imports.c
--- /data/deadwood/source/Mesa-7.7/src/mesa/main/imports.c	2009-12-21 18:08:14.000000000 +0100
+++ mesa/main/imports.c	2009-12-22 18:11:36.000000000 +0100
@@ -566,7 +566,7 @@
 int
 _mesa_ffs(int32_t i)
 {
-#if (defined(_WIN32) ) || defined(__IBMC__) || defined(__IBMCPP__)
+#if (defined(_WIN32) ) || defined(__IBMC__) || defined(__IBMCPP__) || defined(__AROS__)
    register int bit = 0;
    if (i != 0) {
       if ((i & 0xffff) == 0) {
