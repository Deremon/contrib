# Copyright © 2003, The AROS Development Team. All rights reserved.
# $Id$

include $(TOP)/config/make.cfg

EXEDIR := $(CONTRIBDIR)/gnu/patch

#MM- contrib-gnu : contrib-gnu-patch

#MM contrib-gnu-patch : linklibs
contrib-gnu-patch : contrib-gnu-patch-build

#MM contrib-gnu-patch-quick
contrib-gnu-patch-quick : contrib-gnu-patch-build


contrib-gnu-patch-build: .files-touched $(GENDIR)/$(CURDIR)/.configured
	@$(MAKE) -C $(GENDIR)/$(CURDIR)
	@$(MAKE) -C $(GENDIR)/$(CURDIR) install

.files-touched:
	@find . | xargs $(TOUCH) -r configure 
	@$(ECHO) YES > $@

$(GENDIR)/$(CURDIR)/.configured : mmakefile
	%mkdirs_q $(GENDIR)/$(CURDIR)
	@cd $(GENDIR)/$(CURDIR);                                          \
	    $(RM) config.cache;                                           \
	    CC=$(TOOLDIR)/$(AROS_TARGET_CPU)-$(AROS_TARGET_ARCH)-aros-gcc \
	    $(TOP)/$(CURDIR)/configure --prefix=$(EXEDIR)                 \
	    --host=$(AROS_TARGET_CPU)-$(AROS_TARGET_ARCH)-aros
	@$(ECHO) YES > $@

#MM contrib-gnu-patch-clean :
contrib-gnu-patch-clean :
	@if [ -e $(GENDIR)/$(CURDIR)/Makefile ]; then \
	    $(MAKE) -C $(GENDIR)/$(CURDIR) uninstall; \
        fi
	@$(RM) $(GENDIR)/$(CURDIR)
